<!DOCTYPE html>
<html lang="es">
<head>
    <title>Paypal + NUVEI</title>
    <link rel="icon" href="https://docs.nuvei.com/wp-content/themes/manual-child/img/favicons/cropped-favicon-nuvei-32x32.png" sizes="32x32">
    <meta charset="UTF-8">
    <meta name="title" content="Test Nuvei">
    <meta name="description" content="Descripción de la WEB">
    <script src="https://www.paypal.com/sdk/js?client-id=AXsloLh0BwpApDZGmfOdWKiTxlyHi4dLQ63gpsHK1Son0cXtq657wRakklBo29Ja6XKuuih3W3YlVD0r"></script>
    <body>
        <div id="paypal-button-container"></div>
    <script>
    paypal.Buttons({
      createOrder: function(data, actions) {
        return fetch("/.netlify/functions/create-nuvei-order", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ amount: 100, currency: "USD" })
        })
        .then(res => res.json())
        .then(data => {
          if (data.redirectUrl) {
            // Extraer solo el token
            const url = new URL(data.redirectUrl);
            const token = url.searchParams.get("token"); // EC-XXXXX
            if (!token) throw new Error("No se obtuvo token de Nuvei");
            return token; // PayPal espera solo el token, no la URL completa
          }
          throw new Error("No se obtuvo redirectUrl de Nuvei");
        });
      },
      onApprove: function(data, actions) {
        // Aquí podrías capturar la orden si lo deseas
        return actions.order.capture().then(function(details) {
          alert("Pago completado: " + details.id);
        });
      }
    }).render('#paypal-button-container');

    </script>
    </body>  
</html>

